ORIG_PN="itcl"
inherit tcl

DESCRIPTION="Object-oriented extensions for Tcl"
HOMEPAGE="http://incrtcl.sourceforge.net/"
SRC_URI="mirror://sourceforge/incrtcl/${ORIG_PN}${PV}.tar.gz"
SRC_DIR="${ORIG_PN}${PV}"

DISTCLEANFILES="aclocal.m4"

src_compile() {
	cd ${S}
	cygautoreconf
	cd ${B}
	cygconf
	cygmake SHLIB_LD="\$(CC) -shared -Wl,--out-implib,\$@.a"
}

src_install() {
	local slot=${PV_MAJ_MIN}

	cd ${B}
	cyginstall

	insinto /usr/lib/itcl${slot}
	doins libitcl${slot}.dll.a

	mv ${D}/usr/lib/itcl${slot}/libitcl${slot}.dll ${D}/usr/bin
	sed -i -e "s|\"\(libitcl${slot}.dll\)\"|.. .. bin \1|" ${D}/usr/lib/itcl${slot}/pkgIndex.tcl
}
